# **Documentaci√≥n del Proyecto: Asistente M√©dico**

## **1. Introducci√≥n**
### **Problema que resuelve el sistema**
Actualmente, la gesti√≥n de turnos, pacientes, consultas y cirug√≠as se maneja de forma manual con Excel, Word y PDF. Esto genera ineficiencias, errores en los registros y dificultades en el seguimiento de pacientes. 

El sistema automatiza estos procesos, permitiendo:
- Registro estructurado de pacientes.
- Agendamiento y control de turnos (consultas y operaciones).
- Generaci√≥n autom√°tica de informes m√©dicos y protocolos quir√∫rgicos.
- Integraci√≥n con obras sociales y centros m√©dicos.
- Control de acceso por roles (pacientes, doctores, administrativos).

---
## **2. Estructura de Archivos**
### **Ra√≠z del Proyecto**
```
asistente/
‚îú‚îÄ‚îÄ medical_assistant/ 
‚îÇ   ‚îú‚îÄ‚îÄ apps/ 
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ centros_medicos/ 
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ consultas/ 
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ core/ 
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ importacion_excel/ 
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ informes/ 
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ obras_sociales/ 
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ operaciones/ 
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pacientes/ 
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ turnos/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ usuarios/ 
‚îÇ   ‚îú‚îÄ‚îÄ docs/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ documentacion_proyecto.md
‚îÇ   ‚îú‚îÄ‚îÄ media/
‚îÇ   ‚îú‚îÄ‚îÄ medical_assistant/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ settings.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ urls.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ asgi.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ wsgi.py
‚îÇ   ‚îú‚îÄ‚îÄ requirements/
‚îÇ   ‚îú‚îÄ‚îÄ static/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ css/ 
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ js/ 
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ img/ 
‚îÇ   ‚îú‚îÄ‚îÄ templates/
‚îÇ   ‚îú‚îÄ‚îÄ manage.py
venv/
```

### **Descripci√≥n de las Apps**
| **App**              | **Funcionalidad** |
|----------------------|------------------|
| `pacientes`         | Gesti√≥n de pacientes (datos personales, obra social, historial). |
| `turnos`            | Manejo de agendamiento de turnos para consultas y operaciones. |
| `consultas`         | Registro de consultas m√©dicas, diagn√≥sticos y tratamientos. |
| `operaciones`       | Administraci√≥n de cirug√≠as y protocolos quir√∫rgicos. |
| `informes`          | Generaci√≥n de informes en PDF sobre consultas y operaciones. |
| `usuarios`          | Control de acceso y gesti√≥n de usuarios (pacientes, m√©dicos, administrativos). Incluye gesti√≥n de relaciones administrativo-m√©dico y administrativo-centro m√©dico. |
| `obras_sociales`    | Manejo de obras sociales y planes de cobertura. |
| `centros_medicos`   | Administraci√≥n de establecimientos m√©dicos, consultorios y relaciones m√©dico-centro m√©dico. |
| `importacion_excel` | Carga masiva de datos desde archivos Excel. |
| `core`              | Configuraciones generales y utilidades compartidas. |
| `insumos_medicos`   | Gesti√≥n de materiales y medicamentos quir√∫rgicos. |

### **Modelos Principales**
#### **Usuarios y Gesti√≥n**
- `Usuario`: Modelo base extendido de AbstractUser con roles espec√≠ficos
- `Medico`: Informaci√≥n espec√≠fica del m√©dico (tipo, especialidad, matr√≠cula)
- `Administrativo`: Gesti√≥n de personal administrativo
- `GestionAdministrativa`: Manejo de relaciones entre administrativos y m√©dicos/centros m√©dicos

#### **Centros M√©dicos**
- `CentroMedico`: Informaci√≥n b√°sica del centro m√©dico
- `Consultorio`: Gesti√≥n de consultorios por centro m√©dico
- `HorarioAtencion`: Horarios disponibles por consultorio
- `MedicoCentroMedico`: Relaci√≥n entre m√©dicos y centros m√©dicos con horarios

---
## **3. Flujo de Trabajo**
### **Gesti√≥n Administrativa**
1. **Configuraci√≥n Inicial**
   - Creaci√≥n de usuarios (m√©dicos, administrativos)
   - Asignaci√≥n de roles y permisos
   - Establecimiento de relaciones administrativo-m√©dico o administrativo-centro m√©dico

2. **Gesti√≥n de Turnos**
   - **Para administrativos de centro m√©dico:**
     - Acceso a agenda de todos los m√©dicos del centro
     - Gesti√≥n de turnos en cualquier consultorio del centro
     - Control de horarios y disponibilidad
   
   - **Para administrativos de m√©dico:**
     - Acceso a agenda del m√©dico en todos sus centros
     - Gesti√≥n de turnos en los centros donde el m√©dico atiende
     - Control de horarios espec√≠ficos del m√©dico

3. **El paciente solicita turno**
   - Si no est√° en la base de datos, se crea un nuevo registro con datos b√°sicos.
   - A√∫n no tiene turno, doctor, centro m√©dico ni detalles adicionales.
4. **El administrativo asigna el turno.**
   - Se agregan datos clave como el m√©dico, centro m√©dico y autorizaci√≥n de obra social.
   - Se define si el turno es para consulta o cirug√≠a.
5. **El paciente asiste a la consulta.**
   - El m√©dico registra la atenci√≥n y determina si requiere cirug√≠a.
   - Se asigna una operaci√≥n si es necesario.
6. **Si hay cirug√≠a, se prepara el procedimiento.**
   - Se genera el protocolo quir√∫rgico y se asigna instrumentador y anestesista.
7. **El m√©dico genera el informe postoperatorio.**
   - Se genera autom√°ticamente basado en el protocolo y datos preestablecidos
   - El m√©dico puede realizar ajustes y modificaciones post-generaci√≥n
   - Sistema de control de versiones para mantener historial de cambios
   - Los cambios quedan registrados con fecha, hora y usuario que los realiz√≥
   - Se mantiene una copia del informe original y la versi√≥n modificada

### **Gesti√≥n de Informes y Protocolos**
1. **Generaci√≥n del Informe**
   - Creaci√≥n inicial basada en plantilla
   - Incorporaci√≥n de datos del procedimiento
   - Generaci√≥n autom√°tica del PDF

2. **Revisi√≥n y Edici√≥n**
   - El m√©dico revisa el informe generado
   - Si requiere cambios:
     - Accede a la interfaz de edici√≥n
     - Realiza modificaciones necesarias
     - Especifica el motivo del cambio
     - Sistema crea nueva versi√≥n autom√°ticamente

3. **Control de Versiones**
   - Cada modificaci√≥n genera nueva versi√≥n
   - Se mantiene historial completo
   - Acceso a todas las versiones anteriores
   - Capacidad de comparar versiones
   
4. **Visualizaci√≥n de Cambios**
   - Interfaz visual para comparar versiones
   - Tres niveles de comparaci√≥n:
     - Contenido: Diferencias l√≠nea por l√≠nea
     - Variables: Cambios en valores
     - Metadata: Informaci√≥n de modificaci√≥n

5. **Validaci√≥n y Firma**
   - Verificaci√≥n de cambios
   - Aprobaci√≥n m√©dica
   - Firma digital (pendiente)
   - Generaci√≥n de PDF actualizado

### **Validaciones y Controles**
- Verificaci√≥n autom√°tica de disponibilidad seg√∫n horarios establecidos
- Control de superposici√≥n de turnos
- Validaci√≥n de relaciones m√©dico-centro m√©dico activas
- Control de permisos seg√∫n tipo de gesti√≥n administrativa

---
## **4. Estado del Proyecto**
‚úÖ **Implementado:**
- Modelos base creados y migrados
- Sistema de roles y permisos
- Gesti√≥n de relaciones administrativo-m√©dico y administrativo-centro m√©dico
- Control de horarios por m√©dico y centro m√©dico
- Validaciones de disponibilidad y superposici√≥n
- Admin mejorado con filtros y b√∫squedas espec√≠ficas
- Importaci√≥n desde Excel (funcional)
- Sistema de gesti√≥n de protocolos quir√∫rgicos
- Generaci√≥n autom√°tica de documentos PDF
- Sistema de edici√≥n post-generaci√≥n de informes
- Control de versiones en modificaciones de informes
- Interfaz visual para comparaci√≥n de versiones
- Sistema de notificaciones b√°sico implementado

üìå **Pr√≥ximos pasos:**
- Implementar sistema de notificaciones avanzado (email/SMS)
- Desarrollar dashboard para estad√≠sticas
- Implementar sistema de reportes personalizados
- Optimizar el rendimiento de consultas complejas
- Implementar cache para mejorar tiempos de respuesta
- Agregar sistema de firmas digitales para informes modificados
- Desarrollar vista de comparaci√≥n entre versiones de informes

---
## **5. Tecnolog√≠as y Herramientas Utilizadas**
### **Backend**
- **Framework:** Django (Python)
- **Base de Datos:** PostgreSQL
- **Autenticaci√≥n:** Django Auth con roles personalizados
- **Generaci√≥n de PDF:** ReportLab
- **Cache:** Redis
- **Tareas as√≠ncronas:** Celery
- **API REST:** Django Rest Framework
- **Control de Versiones:** difflib para comparaci√≥n de textos

### **Frontend**
- **Templates:** Django Templates
- **CSS Framework:** Bootstrap 5
- **JavaScript:** 
  - Vue.js para componentes din√°micos
  - Axios para llamadas API
  - FullCalendar para gesti√≥n de calendario
- **Dise√±o Responsivo:** Tailwind CSS
- **Comparaci√≥n Visual:** Sistema personalizado de diff

---
## **6. Funcionalidades Detalladas**
### **Sistema de Versionado de Informes**
1. **Control de Versiones**
   - Registro autom√°tico de cada modificaci√≥n
   - Almacenamiento de contenido anterior
   - Tracking de variables modificadas
   - Historial completo de cambios

2. **Interfaz de Edici√≥n**
   - Editor de contenido intuitivo
   - Campo obligatorio para motivo de modificaci√≥n
   - Previsualizaci√≥n de cambios
   - Validaci√≥n de permisos

3. **Visualizaci√≥n de Diferencias**
   - Comparaci√≥n visual l√≠nea por l√≠nea
   - Identificaci√≥n de cambios con colores
   - Tabla comparativa de variables
   - Metadata de modificaciones

4. **Caracter√≠sticas de Seguridad**
   - Control de acceso basado en roles
   - Registro de usuario modificador
   - Timestamp de modificaciones
   - Validaci√≥n de permisos por m√©dico

5. **Gesti√≥n de PDF**
   - Regeneraci√≥n autom√°tica post-modificaci√≥n
   - Almacenamiento de versiones anteriores
   - Acceso al historial de PDFs
   - Comparaci√≥n entre versiones

---
## **7. Pasos a Seguir**
1. **Finalizar integraci√≥n de importaci√≥n de datos desde Excel**
2. **Optimizar la interfaz de administraci√≥n y formularios**
3. **Agregar permisos detallados seg√∫n roles (paciente, m√©dico, administrativo)**
4. **Implementar reportes y gr√°ficos de uso**
5. **Desplegar el sistema en un servidor en producci√≥n**
6. **Futuro:** Permitir que los pacientes completen su informaci√≥n online

---
## **8. Proyecci√≥n del Programa**
‚úî **Expansi√≥n para soportar m√∫ltiples cl√≠nicas y centros m√©dicos**
‚úî **Sistema de gesti√≥n de horarios y disponibilidad**
‚úî **Control granular de permisos y accesos**
‚úî **Implementaci√≥n de un m√≥dulo de facturaci√≥n**
‚úî **Integraci√≥n con sistemas de historias cl√≠nicas digitales**
‚úî **Notificaciones autom√°ticas de turnos a pacientes y m√©dicos**

---
## **9. Contacto y Mantenimiento**
- **Responsable del Proyecto:** [Nombre o equipo]
- **Repositorio de c√≥digo:** [Enlace a GitHub o GitLab]
- **Documentaci√≥n interna:** [Enlace a wiki o Notion]

Esta documentaci√≥n est√° dise√±ada para ser utilizada como prompt en cualquier IA para dar contexto sobre el estado y la direcci√≥n del proyecto. üöÄ

### **M√≥dulo de Importaci√≥n Excel**
#### **Funcionalidades Implementadas**

1. **Previsualizaci√≥n de Excel (`previsualizar_excel`)**
   - Lectura y validaci√≥n de archivos Excel multi-hoja
   - Procesamiento de registros con validaciones
   - Detecci√≥n de errores y advertencias
   - Visualizaci√≥n en tablas HTML
   - Almacenamiento temporal de errores en sesi√≥n

2. **Descarga de Errores (`descargar_errores_excel`)**
   - Exportaci√≥n de errores a formato Excel
   - Generaci√≥n de archivo descargable con errores detectados

3. **Revisi√≥n de Datos (`revisar_excel`)**
   - Validaci√≥n detallada de registros
   - Detecci√≥n de duplicados por DNI
   - Manejo de errores y advertencias por hoja/fila
   - Validaci√≥n de registros individuales

4. **Guardado de Correcciones (`guardar_correcciones`)**
   - Procesamiento de datos corregidos
   - Validaci√≥n final antes del guardado
   - Control de duplicados
   - Manejo de errores y advertencias

#### **Estado Actual**
‚úÖ **Implementado:**
- Sistema completo de validaci√≥n
- Procesamiento de m√∫ltiples hojas
- Detecci√≥n de duplicados
- Manejo de errores y advertencias
- Exportaci√≥n de errores

üìå **Pendiente:**
- Implementar guardado final en base de datos
- Mejorar interfaz de usuario para correcciones
- Agregar validaciones espec√≠ficas por tipo de dato
- Implementar sistema de logs para seguimiento

---

### **Estado Actual del Proyecto**

#### M√≥dulos Implementados:
1. **Sistema de Importaci√≥n de Excel**
   - Carga y validaci√≥n de archivos Excel
   - Previsualizaci√≥n de datos
   - Sistema de correcci√≥n y mapeo de datos
   - Reglas de correcci√≥n autom√°ticas
   - Estad√≠sticas interactivas con Chart.js
   - Notificaciones y manejo de errores

2. **Gesti√≥n de Usuarios**
   - Roles: Paciente, M√©dico, Administrativo
   - Permisos y autenticaci√≥n
   - Gesti√≥n administrativa para m√©dicos y centros

3. **Gesti√≥n de Pacientes**
   - Datos personales y m√©dicos
   - Historial cl√≠nico
   - Vinculaci√≥n con obras sociales

4. **Centros M√©dicos**
   - Gesti√≥n de quir√≥fanos y consultorios
   - Equipamiento m√©dico
   - Convenios con obras sociales

#### Mejoras Recientes:
1. **Estad√≠sticas Interactivas**
   - Gr√°ficos din√°micos con Chart.js
   - Filtros por per√≠odo y tipo de datos
   - Indicadores de carga y animaciones
   - Sistema de notificaciones toast
   - Manejo de errores con reintentos autom√°ticos

2. **Sistema de Notificaciones**
   - Notificaciones toast para feedback
   - Diferentes tipos: success, error, warning, info
   - Animaciones y transiciones suaves
   - Sistema de cola para notificaciones

#### Pendiente por Implementar:
1. **Mejoras en Estad√≠sticas**
   - Exportaci√≥n de datos filtrados
   - M√°s tipos de visualizaciones
   - Cach√© para optimizar rendimiento

2. **Sistema de Notificaciones**
   - Notificaciones en tiempo real
   - Historial de notificaciones
   - Preferencias de notificaci√≥n por usuario

3. **Tests Unitarios**
   - Cobertura de pruebas para m√≥dulos cr√≠ticos
   - Tests de integraci√≥n
   - Tests de interfaz de usuario

4. **Optimizaciones**
   - Mejoras de rendimiento en consultas
   - Implementaci√≥n de cach√©
   - Optimizaci√≥n de carga de assets

### **Pr√≥ximos Pasos**
1. Implementar tests unitarios
2. Mejorar el sistema de notificaciones
3. Optimizar el rendimiento general
4. Documentar API y endpoints

